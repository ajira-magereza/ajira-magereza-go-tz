

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Play</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">




    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <style>
body {
    background-color: #f8f9fa;
background-image: url('anatomy.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

        /* Container for the video section */
        .video-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* 2 columns */
            gap: 20px;
            /* Space between cards */
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Individual video card */
        .video-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Video iframe */
        .videoIframe {
            width: 100%;
            height: 300px;
            /* Adjust height as needed */
            border: none;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .video-container {
                grid-template-columns: 1fr;
                /* 1 column on smaller screens */
            }
        }

        iframe {
            width: 100%;
            height: 100%;
        }

        .download-button {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            background-color: black;
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-button:hover {
            background-color: black;
        }

        /* Styles for the loading spinner */
        #loadingSpinner {
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        /* Overlay to dim the background while loading */
        #loadingOverlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 5;
        }

        /* CSS for YouTube floating button */
        .youtube-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #FF0000;
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            font-size: 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: transform 0.2s ease-in-out;
        }

        .youtube-float:hover {
            transform: scale(1.1);
            text-decoration: none;
        }

        .youtube-float i {
            margin-right: 8px;
            font-size: 20px;
        }

        /* Progress Bar Styling */
        #progressBarContainer {
            background-color: rgba(110, 110, 110, 0.9);
            /* Semi-transparent white background */
            padding: 20px;
            border-radius: 100px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .progress {
            height: 40px;
            border-radius: 100px;
            overflow: hidden;
        }

        .progress-bar {
            background-color: #007bff;
            /* Bootstrap primary color */
            transition: width 0.3s ease;
            /* Smooth transition for width changes */
        }
    </style>

    <!-- CSS -->
    <style>
        .youtube-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #FF0000;
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            font-size: 16px;
            text-decoration: none;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: transform 0.2s ease-in-out;
        }

        .youtube-float:hover {
            transform: scale(1.1);
            text-decoration: none;
        }

        .youtube-float i {
            margin-right: 8px;
            font-size: 20px;
        }
    </style>
</head>

<body>
    <!-- Spinner with Thickness -->
    <div id="spinnerContainer" class="d-flex justify-content-center align-items-center" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem; border-width: 0.5rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

            <!-- section 2 (for other countries) -->
        <div class="video-container" id="section2">
            <a class="download-button" href="" target="_blank" download>
                <i class="bi bi-download"></i> Download Pdf
            </a>
            <iframe id="videoIframe" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>

            <!--<iframe id="videoIframe" src="https://drive.google.com/file/d/1iOka5jfTJ0JbGoTkMqN1BYmhBx0xIlwV/preview" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>-->
        </div>
    
    <!-- Modal for Redirect to Official Site -->
    <div class="modal fade" id="downloadModal" tabindex="-1" aria-labelledby="downloadModalLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">


                </div>
                <div class="modal-body">
                    <div id="loadingOverlay">
                        <div id="loadingSpinner"></div>
                    </div>

                                        <div class="modal-body">
                        <div class="container text-center">
                            <span class="age-restriction badge bg-danger text-white">HOME OF MEDICAL STUDENTS</span>

                            <!-- Heading -->
                            <h3 class="mt-3">Lipia Tsh 5000/= Ku-Download</h3>

                            <!-- List of Features -->
                            <ul class="list-unstyled text-left mt-4">
                                <li><strong>Anatomy And Physiology Modules </strong></li>
                                <li><strong>Bank Of Question Of Anoatomy</strong></li>
                                <li><strong>Possible Questions</strong></li>
                                <li><strong>Practical Examination Questions</strong></li>
                            </ul>
                        </div>
                        <!-- Body content -->
                        <img src="https://utelezi-tv.online/CP00090071/images/zenopay-logo.png" alt="Zenopay Logo" class="img-fluid">
                        <p class="text-center" style="font-size: 0.75rem;">Weka Pesa kupitia mitandao ya simu,<strong>weka namba yako ya simu</strong> </p>
                        <div id="loadingOverlay">
                            <div id="loadingOverlay">

                            </div>
                        </div>

                        <form id="paymentForm">
                            <div class="mb-3">
                                <label for="phone" class="form-label">Namba ya Simu yenye hela*</label>
                                <input type="text" class="form-control" id="phone" name="phone" placeholder="Andika namba ya simu" required>
                            </div>

                            <!-- Section 1 -->
                            <div class="mb-3">


                                <div class="form-check">
                                    <input class="form-check-input" type="hidden" name="package" id="package3" value="2000" required>

                                </div>
                            </div>

                            <button type="submit" id="payButton" class="btn btn-primary w-100">LIPIA</button>


                        </form>





                    </div>

                </div>
            </div>

            <!-- acc modal -->

        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

        <script>
            const videoIframe = document.getElementById('videoIframe');
            const downloadModal = new bootstrap.Modal(document.getElementById('downloadModal'));

            function exitFullscreen() {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }

            document.querySelector('.download-button').addEventListener('click', (e) => {
                e.preventDefault();
                exitFullscreen();
                setTimeout(() => downloadModal.show(), 300);
            });

            setTimeout(() => {
                if (!downloadModal._isShown) {
                    exitFullscreen();
                    downloadModal.show();
                }
            }, 10000);
        </script>>
        <script>
            // Function to animate the progress bar for 5 seconds
            function animateProgressBar() {
                const progressBar = document.getElementById('progressBar');
                const duration = 10000; // 5 seconds in milliseconds
                const interval = 50; // Update every 50ms
                const steps = duration / interval; // Total steps to reach 100%
                let width = 0;

                const progressInterval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(progressInterval);
                        // Hide the progress bar after completion
                        document.getElementById('progressBarContainer').style.display = 'none';
                    } else {
                        width += (100 / steps); // Increment width based on steps
                        progressBar.style.width = width + '%';
                        progressBar.setAttribute('aria-valuenow', width);
                        progressBar.textContent = Math.round(width) + '%'; // Round to the nearest integer
                    }
                }, interval); // Update every 50ms
            }

            // Start the progress bar animation when the page loads
            window.onload = animateProgressBar;
        </script>

        <script>
            // Function to hide the spinner after 5 seconds
            function hideSpinner() {
                setTimeout(() => {
                    document.getElementById('spinnerContainer').style.display = 'none';
                }, 10000); // Hide after 5 seconds
            }

            // Start the spinner and hide it after 5 seconds when the page loads
            window.onload = hideSpinner;
        </script>



        <script>
            $(document).ready(function() {
                // Handle form submission with AJAX
                $('#paymentForm').on('submit', function(e) {
                    e.preventDefault(); // Prevent the default form submission

                    // Show the spinner while the request is being processed
                    $('#loadingOverlay').show();

                    // Prepare the form data to be sent
                    const formData = $(this).serialize();

                    // Send the form data to zenopay.php using AJAX
                    $.ajax({
                        url: 'whlpay.php', // Your PHP processing script
                        type: 'POST',
                        data: formData,
                        dataType: 'json', // Expect JSON response
                        success: function(response) {
                            // Hide the spinner
                            $('#loadingOverlay').hide();

                            if (response.status === 'success') {
                                // Log the order ID to the console
                                console.log('Order ID: ' + response.message); // Assuming response.message is the order ID

                                // Now use the order ID to check the payment status
                                checkOrderStatus(response.message);
                            } else {
                                // Display error message
                                alert(response.message);
                            }
                        },
                        error: function() {
                            // Hide the spinner
                            $('#loadingOverlay').hide();

                            // Show an error message
                            alert('An error occurred while processing your request.');
                        }
                    });
                });

                // Function to check order status
                function checkOrderStatus(orderId) {
                    // Show the spinner while the status check is in progress
                    $('#loadingOverlay').show();

                    // Number of attempts to check the status
                    var attempts = 0;
                    var maxAttempts = 9;

                    // Function to check the order status
                    function checkStatus() {
                        // Data to send with the AJAX request
                        var data = {
                            'check_status': 1,
                            'order_id': orderId
                        };

                        // Send the order ID to check the order status
                        $.ajax({
                            url: 'check-status.php', // PHP script to check order status
                            type: 'POST',
                            data: data,
                            dataType: 'json', // Expect JSON response
                            success: function(statusResponse) {
                                // Hide the spinner


                                if (statusResponse.status === 'success') {
                                    console.log('Payment Status: ' + statusResponse.payment_status);

                                    // If payment status is COMPLETED, stop checking and exit
                                    if (statusResponse.payment_status === 'COMPLETED') {
                                        //alert('Payment successful!');
                                        $('#loadingOverlay').hide();
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Payment Successful!',
                                            text: 'Your payment has been completed successfully.',
                                            confirmButtonText: 'OK'
                                        }).then(() => {

                                            // Optionally, redirect after success
                                            window.location.href = "https://drive.google.com/file/d/1IE7y1BreyDK1MG5GzoVkslKKtVNVsL-J/view?usp=sharing"; // Use orderId instead of response.message

                                        });

                                        return;
                                    }

                                    // If payment status is PENDING, keep checking
                                    if (statusResponse.payment_status === 'PENDING' && attempts < maxAttempts - 1) {
                                        attempts++;
                                        console.log('Checking again... Attempt ' + (attempts + 1));
                                        updateOrderStatus(orderId, 'Pending');
                                        setTimeout(checkStatus, 3000); // Wait for 3 seconds before the next check
                                    } else {
                                        //alert('Payment still pending. Please check again later.');
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Payment Failed',
                                            text: 'There was an issue with your payment. Please try again.',
                                            confirmButtonText: 'Try Again'
                                        });
                                        $('#loadingOverlay').hide();
                                    }
                                } else {
                                    // Display error message if status check failed
                                    alert('Error checking status: ' + statusResponse.message);
                                }
                            },
                            error: function() {
                                // Hide the spinner
                                $('#loadingOverlay').hide();

                                // Show an error message if status check failed
                                alert('An error occurred while checking the order status.');
                            }
                        });
                    }

                    function updateOrderStatus(orderId, status) {
                        console.log('Order status updated to ' + status);
                        $.ajax({
                            url: 'update-order-status.php', // PHP script to update the order status
                            type: 'POST',
                            data: {
                                order_id: orderId,
                                status: status
                            },
                            dataType: 'json',
                            success: function(response) {
                                if (response.status === 'success') {
                                    console.log('Order status updated to ' + status);
                                } else {
                                    console.error('Failed to update order status: ' + response.message);
                                }
                            },
                            error: function() {
                                console.error('An error occurred while updating the order status.');
                            }
                        });
                    }

                    // Start the first check
                    checkStatus();
                }

            });



            function updateOrderStatus(orderId, status) {
                console.log('Order status updated to ' + status);
                $.ajax({
                    url: 'update-order-status.php', // PHP script to update the order status
                    type: 'POST',
                    data: {
                        order_id: orderId,
                        status: status
                    },
                    dataType: 'json',
                    success: function(response) {
                        if (response.status === 'success') {
                            console.log('Order status updated to ' + status);
                        } else {
                            console.error('Failed to update order status: ' + response.message);
                        }
                    },
                    error: function() {
                        console.error('An error occurred while updating the order status.');
                    }
                });
            }
        </script>

        <!-- SweetAlert2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
</body>

</html>